<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>HomeAutomationService ZUCK</title>
    <link rel="stylesheet" href="stylesheets/reset.css">
    <link rel="stylesheet" href="stylesheets/stylesheet.css">
    <link rel="stylesheet" href="stylesheets/responsive.css">
    <link rel="stylesheet" href="stylesheets/mobile.css">
</head>

<body id="top">
<header>
    <!--<h1 onclick="topFunction()" id="topHeader">ZUCK</h1>-->
    <h1 href="#top" onclick="scrollToTop();return false">ZUCK</h1>
</header>

<!--------- NEWS ------->
<div id="newsSection">
    <input id="toggle" type="checkbox" unchecked>
    <label for="toggle"><img src="images/news.svg">NEWS</label>
    <img id="newsIcon" src="images/news.svg">
    <div id="expand">
        <section id="news">
        </section>
    </div>
</div>

<!--------- SIDE ------->
<aside>
    <div id="obenrechts">
        <div id="time">
            <div><p id="clock"></p></div>
            <div><p id="date"></p></div>
        </div>

        <div id="weather">
            <div id="weatherIconAndInfo">
                <img id="weatherIcon" src="images/weather.svg">
                <div id="CelsiusAndLoc">
                    <p id="currentWeather"></p>
                    <p id="location"></p>
                </div>
            </div>
              <div id="indoorcontainer">
                <img src="images/chiphouse.svg">

                <table id="indoortemphumid">
                    <tr>
                        <th id="temp">Raumtemperatur: <%= temperature1 %> 째C</th>
                    </tr>
                    <tr>
                        <th id="humid">Luftfeuchtigkeit: <%= humidity1 %> %</th>
                    </tr>
                </table>
                <!--<div id="temp"><p>Raumtemperatur: <%= temperature1 %> 째C</p></div>
                <div id="humid"><p>Luftfeuchtigkeit: <%= humidity1 %> %</p></div>-->
            </div>
        </div>
      
    </div>

    <div id="sensor">
        <input id="toggle2" type="checkbox" unchecked>
        <label for="toggle2"><img src="images/chip.svg">SENSOR</label>

        <div id="expand2">
            <%for (var i = 0; i < soilSensors.length; i++) { %>
            <div class="plants">
                <img id="plantIcon" src="images/plant.svg">

                <span class="sensorName">Pflanze <%=i + 1%></span>

                <div class="plantHumid">
                    <img src="images/humidity.svg">
                    <span><%=soilSensors[0].humidity%></span>
                </div>
            </div>
            <%}%>
            <div class="windows">
                <%for (var i = 0; i < windowSensors.length; i++) { %>
                <img id="windowIcon" src="<%=windowSensors[i].imgSrc%>">
                <span class="sensorName">Fenster <%=i + 1%></span><br>
                <span class="sensorStatus"><%= windowSensors[i].status %></span>
                <%}%>
            </div>
            <div class="windows">
                <img id="windowIcon" src="images/mailboxEmpty.svg">
                <span class="sensorName">Briefkasten</span><br>
                <span class="sensorStatus"><%=mailboxSensors[0].status%></span>
            </div>
        </div>
    </div>
</aside>

<section class="inner-wrapper">

    <!--------- MEDIA ------->
    <section id="media">
        <input id="toggleMedia" type="checkbox" unchecked>
        <label for="toggleMedia"><img src="images/playbutton.svg">MEDIA</label>
        <h2>Media</h2>
        <div id="expandMedia">
            <section id="device">
                <div tabIndex="1" id="stereo">
                    <a tabIndex="-1" href="http://192.168.0.107/socketONOFF"><img id="stereoIcon" src="images/coffee.svg"></a>
                    <span>Kaffee</span>
                </div>
                <div tabIndex="2" id="tv">
                    <a tabIndex="-1" href="http://192.168.0.107/TVONOFF"><img id="tvIcon" src="images/tv.svg"></a>
                    <span>TV Wohnzimmer</span>
                </div>
            </section>
        </div>
    </section>

    <!--------- LIGHT ------->
    <section class="light">
        <input id="toggleLight" type="checkbox" unchecked>
        <label for="toggleLight"><img src="images/lamp.svg">LIGHT</label>
        <h2>Licht</h2>

        <div id="expandLight">
            <section tabIndex="3" class="bulb" id="bulb">
                <%if(lights[0].ip != 0){%>
                <% for(var i = 0; i < lights.length; i++) { %>
                <div class="light1">
                    <a href="/lights/<%=lights[i].ip %>">
                        <img name="bulbIcon" src="<%=lights[i].imgSrc%>">
                        <p><%=lights[i].label %></p>
                    </a>
                </div>

                <% } %>
                <% } %>
            </section>

            <section class="bulb">

                <div class="light1">
                    <a href="/LichtRed">
                        <img src="images/lightbulb_new.svg">
                        <p>Flur Unten</p>
                    </a>
                </div>
                <div class="light1">
                    <a href="/LichtBlue">
                        <img src="images/lightbulb_new.svg">
                        <p>Flur Oben</p>
                    </a>
                </div>
                <div class="light1">
                    <a href="/LichtGreen">
                        <img src="images/lightbulb_new.svg">
                        <p>Garage</p>
                    </a>
                </div>

            </section>
        </div>
    </section>
</section>



<!--------- NEWS SCRIPT ------->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        var url = 'https://newsapi.org/v1/articles?source=die-zeit&sortBy=latest&apiKey=a1ef913e98c94358994dc8a8f7347aff&lang=de';
        $.getJSON(url).then(function (res) {

            var artNo = 0;

            document.getElementById("news").innerHTML =
                "<a tabIndex=\"-1\" href=\""
                +  (res['articles'][artNo].url)
                + "\"><h3>"
                + (res['articles'][artNo].title)
                + "</h3><br><p>"
                + (res['articles'][artNo].description)
                + "</p></a><br><a tabIndex=\"-1\" href=\""
                + (res['articles'][artNo + 1].url)
                + "\"><h3>"
                + (res['articles'][artNo + 1].title)
                + "</h3><br><p>"
                + (res['articles'][artNo + 1].description)
                + "</p></a><br><a tabIndex=\"-1\" href=\""
                + (res['articles'][artNo + 2].url)
                + "\"><h3>"
                + (res['articles'][artNo + 2].title)
                + "</h3><br><p>"
                + (res['articles'][artNo + 2].description)
                + "</p></a>";

            setInterval(function () {
                if (artNo <= 6) artNo += 3;
                else artNo = 0;

                document.getElementById("news").innerHTML =
                    "<a tabIndex=\"-1\" href=\""
                    +  (res['articles'][artNo].url)
                    + "\"><h3>"
                    + (res['articles'][artNo].title)
                    + "</h3><br><p>"
                    + (res['articles'][artNo].description)
                    + "</p></a><br><br><a tabIndex=\"-1\" href=\""
                    + (res['articles'][artNo + 1].url)
                    + "\"><h3>"
                    + (res['articles'][artNo + 1].title)
                    + "</h3><br><p>"
                    + (res['articles'][artNo + 1].description)
                    + "</p></a><br><br><a tabIndex=\"-1\" href=\""
                    + (res['articles'][artNo + 2].url)
                    + "\"><h3>"
                    + (res['articles'][artNo + 2].title)
                    + "</h3><br><p>"
                    + (res['articles'][artNo + 2].description)
                    + "</p></a>";

            }, 30000);
        })
    })

</script>

<!--------- WEATHER SCRIPT ------->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        var api = "http://api.openweathermap.org/data/2.5/weather?q=Berlin&units=metric&lang=de&APPID=bf0a224a7b36d53836dd5e19f4b986a8";
        $.getJSON(api, function (data) {

            document.getElementById("currentWeather").innerHTML = data.main.temp + " 째C, " + data.weather[0].description;
            document.getElementById("location").innerHTML = data.name + ", " + data.sys.country;

        });
    })
</script>

<!--------- TIME SCRIPT ------->
<script src="javascript/zuckJS.js"></script>
<script type="text/javascript">
    /*setTimeout(function(){
     window.location.reload(1);
     }, 5000);     */

    function updateTimeAndDate() {
        var weekdays = new Array("Sonntag", "Montag", "Dienstag", "Mittwoch", "Donnerstag", "Freitag", "Samstag");
        var months = new Array("Januar", "Februar", "M채rz", "April", "Mai", "Juni", "Juli", "August", "September", "Oktober", "November", "Dezember");
        var currDate = new Date();
        var weekday = weekdays[currDate.getDay()];
        var day = currDate.getDate();
        var month = months[currDate.getMonth()];
        var year = currDate.getFullYear();
        document.getElementById("date").innerHTML = weekday + ", " + day + ". " + month + " " + year;
        var hr = currDate.getHours();
        var min = currDate.getMinutes();
        if (min < 10) {
            min = "0" + min;
        }
        document.getElementById("clock").innerHTML = hr + ":" + min;
        setInterval(updateTimeAndDate, 10000);
    }
    updateTimeAndDate();

</script>

<!--------- REFRESH LIGHT BULBS SCRIPT ------->
<script>
    setInterval(function() {
        var lightClasses = document.getElementsByName("bulbIcon");
        var lightsVar = <%- JSON.stringify(lights) %>;
        var needsRefresh = false;
        if(lightClasses[0]) {
            for (var i = 0; i < lightsVar.length; i++) {

                var lightClass = lightClasses[i];
                var imageLink = lightClass.src;
                imageLink = imageLink.split("/");
                imageLink = imageLink[imageLink.length - 2] + '/' + imageLink[imageLink.length - 1];

                if (lightsVar[i].imgSrc != imageLink) {
                    needsRefresh = true;
                    document.getElementsByClassName("bulbIcon")[i].src = lightsVar[i].imgSrc;
                }
                console.log(document.getElementsByClassName("bulbIcon"));
                console.log(lightsVar[i].imgSrc);
                console.log('\n\n');
            }
        }
        if(needsRefresh){
            console.log("needs refresh");

            $("#bulb").load(location.href + " #bulb>*", "");
        }else{
            console.log("no refresh");
        }
    }, 1000); //bulb section jede Sekunde neu laden


</script>
<script>
    var timeOut;
    function scrollToTop() {
        if (document.body.scrollTop!=0 || document.documentElement.scrollTop!=0){
            window.scrollBy(0,-50);
            timeOut=setTimeout('scrollToTop()',10);
        }
        else clearTimeout(timeOut);
    }
</script>

</body>
</html>
